# 11.1.3 Plan de Implementación

## Objetivo de Aprendizaje

Al finalizar este subtema, tendrás un plan de implementación detallado y priorizado para construir el sistema multi-agente, con milestones claros y criterios de aceptación.

## Introducción

Un plan de implementación sólido convierte el diseño arquitectónico en pasos ejecutables. Definimos fases, dependencias, y criterios de éxito para cada milestone.

```
┌─────────────────────────────────────────────────────────────────┐
│                 PLAN DE IMPLEMENTACIÓN                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  FASE 1           FASE 2           FASE 3          FASE 4      │
│  Foundation       Core Agents      Integration     Production  │
│  ─────────►      ─────────►      ─────────►      ──────────   │
│                                                                 │
│  • Setup          • Orchestrator   • Multi-agent   • Docker    │
│  • Base Agent     • Researcher     • Memory        • K8s       │
│  • Tools infra    • Analyst        • API           • Monitoring│
│  • Memory infra   • Writer/Critic  • Testing       • Security  │
│                                                                 │
│  Semana 1-2       Semana 3-4       Semana 5-6      Semana 7-8  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Plan Detallado por Fases

### Fase 1: Foundation (Semana 1-2)

```python
PHASE_1 = {
    "name": "Foundation",
    "duration": "2 semanas",
    "goal": "Infraestructura base y primer agente funcional",
    "milestones": [
        {
            "id": "M1.1",
            "name": "Project Setup",
            "tasks": [
                "Crear estructura de directorios",
                "Configurar pyproject.toml y dependencias",
                "Setup Docker Compose (Redis, PostgreSQL, ChromaDB)",
                "Configurar settings con pydantic-settings",
                "Crear .env.example con variables necesarias",
                "Setup pytest y estructura de tests",
                "Configurar CI básico (linting, type checking)"
            ],
            "acceptance_criteria": [
                "docker-compose up levanta todos los servicios",
                "pytest descubre y ejecuta tests",
                "Settings se cargan correctamente desde .env"
            ],
            "estimated_hours": 8
        },
        {
            "id": "M1.2",
            "name": "Base Agent Framework",
            "tasks": [
                "Implementar BaseAgent abstracto",
                "Sistema de registro de tools",
                "Loop de agente (prompt → LLM → tool → response)",
                "Manejo de errores y reintentos",
                "Logging estructurado integrado",
                "Tests unitarios del framework base"
            ],
            "acceptance_criteria": [
                "BaseAgent puede instanciarse con tools",
                "Loop ejecuta correctamente con Gemini",
                "Errores se manejan sin crash",
                "Logs en formato JSON estructurado"
            ],
            "estimated_hours": 12
        },
        {
            "id": "M1.3",
            "name": "Tools Infrastructure",
            "tasks": [
                "Implementar BaseTool con validación",
                "Tool: web_search (integración real o mock)",
                "Tool: extract_content (web scraping básico)",
                "Tool: calculate (evaluación segura)",
                "Tests unitarios para cada tool",
                "Tool registry y descubrimiento"
            ],
            "acceptance_criteria": [
                "Cada tool tiene tests que pasan",
                "Tools se registran y descubren automáticamente",
                "Validación de inputs funciona correctamente"
            ],
            "estimated_hours": 10
        },
        {
            "id": "M1.4",
            "name": "Memory Infrastructure",
            "tasks": [
                "Implementar WorkingMemory (Redis)",
                "Implementar SemanticMemory (ChromaDB)",
                "Implementar PersistentMemory (PostgreSQL)",
                "MemoryManager unificado",
                "Tests de integración para cada tipo",
                "Seed data para desarrollo"
            ],
            "acceptance_criteria": [
                "CRUD en cada tipo de memoria funciona",
                "Búsqueda semántica retorna resultados relevantes",
                "MemoryManager abstrae los backends",
                "Tests de integración pasan con servicios reales"
            ],
            "estimated_hours": 12
        }
    ]
}
```

### Fase 2: Core Agents (Semana 3-4)

```python
PHASE_2 = {
    "name": "Core Agents",
    "duration": "2 semanas",
    "goal": "Todos los agentes implementados y testeados individualmente",
    "milestones": [
        {
            "id": "M2.1",
            "name": "Researcher Agent",
            "tasks": [
                "Implementar ResearcherAgent extendiendo BaseAgent",
                "Integrar tools de búsqueda y extracción",
                "Implementar lógica de múltiples queries",
                "Evaluación de calidad de fuentes",
                "Almacenamiento de hallazgos en memoria semántica",
                "Tests: búsqueda exitosa, sin resultados, errores"
            ],
            "acceptance_criteria": [
                "Busca con 3+ queries por tema",
                "Almacena hallazgos en ChromaDB",
                "Output sigue schema definido",
                "Maneja errores de búsqueda gracefully"
            ],
            "estimated_hours": 10
        },
        {
            "id": "M2.2",
            "name": "Analyst Agent",
            "tasks": [
                "Implementar AnalystAgent",
                "Integrar tool de cálculos",
                "Lógica de identificación de patrones",
                "Generación de insights con evidencia",
                "Tests con datos variados"
            ],
            "acceptance_criteria": [
                "Genera insights basados en datos",
                "Identifica patrones en hallazgos",
                "Output incluye scores de confianza"
            ],
            "estimated_hours": 8
        },
        {
            "id": "M2.3",
            "name": "Writer Agent",
            "tasks": [
                "Implementar WriterAgent",
                "Template de reporte con secciones",
                "Integración con datos de Researcher y Analyst",
                "Formateo Markdown con referencias",
                "Tests de generación de reportes"
            ],
            "acceptance_criteria": [
                "Genera reporte con todas las secciones",
                "Incluye referencias correctamente",
                "Markdown válido y legible"
            ],
            "estimated_hours": 8
        },
        {
            "id": "M2.4",
            "name": "Critic Agent",
            "tasks": [
                "Implementar CriticAgent",
                "Sistema de scoring multi-criterio",
                "Detección de issues específicos",
                "Generación de feedback accionable",
                "Tests con reportes de diferente calidad"
            ],
            "acceptance_criteria": [
                "Evalúa en 6 dimensiones con scores",
                "Identifica issues con sugerencias",
                "Decisión approve/revise/reject consistente"
            ],
            "estimated_hours": 8
        },
        {
            "id": "M2.5",
            "name": "Orchestrator Agent",
            "tasks": [
                "Implementar OrchestratorAgent",
                "Lógica de planificación de investigación",
                "Sistema de delegación de tareas",
                "Monitoreo de progreso",
                "Consolidación de resultados",
                "Tests del flujo de orquestación"
            ],
            "acceptance_criteria": [
                "Descompone query en subtemas",
                "Delega correctamente a cada agente",
                "Maneja timeouts y errores de agentes",
                "Consolida resultado final"
            ],
            "estimated_hours": 12
        }
    ]
}
```

### Fase 3: Integration (Semana 5-6)

```python
PHASE_3 = {
    "name": "Integration",
    "duration": "2 semanas",
    "goal": "Sistema integrado con API funcional y tests E2E",
    "milestones": [
        {
            "id": "M3.1",
            "name": "Multi-Agent Communication",
            "tasks": [
                "Implementar MessageBroker con Redis Pub/Sub",
                "Schema de mensajes estandarizado",
                "Conectar Orchestrator con agentes vía broker",
                "Manejo de mensajes de error y timeout",
                "Tests de comunicación inter-agente"
            ],
            "acceptance_criteria": [
                "Agentes se comunican vía message broker",
                "Mensajes siguen schema validado",
                "Timeouts se detectan y manejan"
            ],
            "estimated_hours": 10
        },
        {
            "id": "M3.2",
            "name": "API REST",
            "tasks": [
                "FastAPI app con lifespan management",
                "Endpoints: POST /research, GET /research/{id}",
                "Endpoints: POST /chat, GET /reports",
                "Autenticación con API Keys",
                "Rate limiting",
                "Documentación OpenAPI"
            ],
            "acceptance_criteria": [
                "Endpoints funcionan correctamente",
                "Auth requerida para todos los endpoints",
                "Rate limiting activo",
                "Swagger docs disponibles en /docs"
            ],
            "estimated_hours": 10
        },
        {
            "id": "M3.3",
            "name": "End-to-End Flow",
            "tasks": [
                "Integrar API → Orchestrator → Agents → Response",
                "Flujo completo de investigación funcional",
                "Progreso en tiempo real vía polling",
                "Almacenamiento de reportes finales",
                "Tests E2E del flujo completo"
            ],
            "acceptance_criteria": [
                "POST /research inicia investigación completa",
                "GET /research/{id} muestra progreso",
                "Reporte final disponible al completar",
                "Flujo completo < 5 minutos"
            ],
            "estimated_hours": 12
        },
        {
            "id": "M3.4",
            "name": "Testing Comprehensive",
            "tasks": [
                "Tests unitarios: >80% coverage",
                "Tests de integración por flujo",
                "Tests adversariales de seguridad",
                "Tests de performance",
                "Fix bugs encontrados"
            ],
            "acceptance_criteria": [
                "Suite de tests completa",
                "Coverage > 80%",
                "Tests adversariales pasan",
                "Performance dentro de SLOs"
            ],
            "estimated_hours": 12
        }
    ]
}
```

### Fase 4: Production (Semana 7-8)

```python
PHASE_4 = {
    "name": "Production",
    "duration": "2 semanas",
    "goal": "Sistema desplegado con observabilidad completa",
    "milestones": [
        {
            "id": "M4.1",
            "name": "Containerization",
            "tasks": [
                "Dockerfile multi-stage optimizado",
                "docker-compose.prod.yml",
                "Scripts de build y test",
                "Image scanning de seguridad",
                "Manifiestos Kubernetes"
            ],
            "acceptance_criteria": [
                "Build exitoso < 5 minutos",
                "Imagen < 500MB",
                "K8s manifiestos aplican sin errores",
                "Health checks funcionan"
            ],
            "estimated_hours": 8
        },
        {
            "id": "M4.2",
            "name": "Observability",
            "tasks": [
                "Métricas Prometheus implementadas",
                "Tracing OpenTelemetry integrado",
                "Dashboard Grafana configurado",
                "Reglas de alertas definidas",
                "Logging estructurado completo"
            ],
            "acceptance_criteria": [
                "/metrics endpoint activo",
                "Traces visibles en Jaeger",
                "Dashboard con métricas clave",
                "Alertas disparan correctamente"
            ],
            "estimated_hours": 10
        },
        {
            "id": "M4.3",
            "name": "Security Hardening",
            "tasks": [
                "JWT authentication completo",
                "RBAC implementado",
                "Input sanitization",
                "Secrets management",
                "Security audit y fixes"
            ],
            "acceptance_criteria": [
                "Auth funciona con JWT y API Keys",
                "3 roles con permisos diferenciados",
                "Tests adversariales de seguridad pasan",
                "No secrets en código"
            ],
            "estimated_hours": 8
        },
        {
            "id": "M4.4",
            "name": "Documentation & Demo",
            "tasks": [
                "README completo del proyecto",
                "API documentation",
                "Architecture decision records",
                "Runbooks para operaciones",
                "Demo script preparado"
            ],
            "acceptance_criteria": [
                "README permite setup desde cero",
                "API docs completas y precisas",
                "ADRs documentan decisiones clave",
                "Demo funciona end-to-end"
            ],
            "estimated_hours": 8
        }
    ]
}
```

## Timeline Visual

```python
TIMELINE = """
SEMANA 1 ──────────────────────────────────────────
  [M1.1] Project Setup ██████
  [M1.2] Base Agent Framework ████████████████

SEMANA 2 ──────────────────────────────────────────
  [M1.3] Tools Infrastructure ██████████████
  [M1.4] Memory Infrastructure ████████████████

SEMANA 3 ──────────────────────────────────────────
  [M2.1] Researcher Agent ██████████████
  [M2.2] Analyst Agent ████████████

SEMANA 4 ──────────────────────────────────────────
  [M2.3] Writer Agent ████████████
  [M2.4] Critic Agent ████████████
  [M2.5] Orchestrator Agent ████████████████

SEMANA 5 ──────────────────────────────────────────
  [M3.1] Multi-Agent Communication ██████████████
  [M3.2] API REST ██████████████

SEMANA 6 ──────────────────────────────────────────
  [M3.3] End-to-End Flow ████████████████
  [M3.4] Testing Comprehensive ████████████████

SEMANA 7 ──────────────────────────────────────────
  [M4.1] Containerization ████████████
  [M4.2] Observability ██████████████

SEMANA 8 ──────────────────────────────────────────
  [M4.3] Security Hardening ████████████
  [M4.4] Documentation & Demo ████████████

TOTAL ESTIMADO: ~168 horas (8 semanas × ~21 horas/semana)
"""

print(TIMELINE)
```

## Checklist de Completitud

```python
COMPLETION_CHECKLIST = {
    "code": [
        "BaseAgent con loop funcional",
        "5 agentes especializados implementados",
        "6+ tools implementadas y testeadas",
        "3 tipos de memoria funcionando",
        "Message broker operativo",
        "API REST con 4+ endpoints",
        "Autenticación y autorización",
        "Rate limiting"
    ],
    "tests": [
        "Unit tests > 80% coverage",
        "Integration tests por flujo",
        "E2E test del flujo completo",
        "Adversarial tests de seguridad",
        "Performance tests"
    ],
    "infrastructure": [
        "Dockerfile optimizado",
        "docker-compose funcional",
        "K8s manifiestos",
        "CI pipeline básico"
    ],
    "observability": [
        "Métricas Prometheus",
        "Tracing OpenTelemetry",
        "Structured logging",
        "Dashboard Grafana",
        "Alertas configuradas"
    ],
    "documentation": [
        "README con setup instructions",
        "API documentation",
        "Architecture diagrams",
        "ADRs",
        "Runbooks"
    ]
}

def print_checklist():
    total = sum(len(items) for items in COMPLETION_CHECKLIST.values())
    print(f"\n{'='*60}")
    print(f"CHECKLIST DE COMPLETITUD ({total} items)")
    print(f"{'='*60}")

    for category, items in COMPLETION_CHECKLIST.items():
        print(f"\n  {category.upper()} ({len(items)} items)")
        for item in items:
            print(f"    [ ] {item}")

print_checklist()
```

## Ejercicios Prácticos

### Ejercicio 1: Personalizar Plan
Ajusta el plan a tu disponibilidad:
- Si tienes 10h/semana: ¿qué priorizas?
- Si tienes 40h/semana: ¿qué agregas?

### Ejercicio 2: Risk Mitigation
Para cada fase, identifica:
- Principal riesgo técnico
- Plan de mitigación
- Criterio de "go/no-go"

### Ejercicio 3: MVP Definition
Define un MVP mínimo que funcione:
- ¿Cuáles milestones son imprescindibles?
- ¿Qué puedes simplificar?
- ¿Cuál es el flujo mínimo viable?

## Resumen

| Fase | Duración | Milestones | Horas |
|------|----------|------------|-------|
| Foundation | 2 semanas | 4 | 42h |
| Core Agents | 2 semanas | 5 | 46h |
| Integration | 2 semanas | 4 | 44h |
| Production | 2 semanas | 4 | 34h |
| **Total** | **8 semanas** | **17** | **~166h** |

---

**Siguiente:** [11.2.1 Desarrollo de Agentes Core](../tema_11.2/11.2.1-desarrollo-agentes-core.md)
